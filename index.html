<script>
  function parseTime(timeStr) {
    const [min, sec] = timeStr.split(":").map(Number);
    return (min * 60 + sec) * 1000;
  }

  function formatClockTime(date) {
    let hours = date.getHours();
    let minutes = date.getMinutes();
    const ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12 || 12;
    minutes = minutes.toString().padStart(2, "0");
    return `${hours}:${minutes} ${ampm}`;
  }

  // New helper to format milliseconds as MM:SS (net race time)
  function formatDuration(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const min = Math.floor(totalSeconds / 60);
    const sec = totalSeconds % 60;
    return `${min}:${sec.toString().padStart(2, "0")}`;
  }

  function calculateTimeRanges(startTimeStr, paceMinStr, paceMaxStr, distances) {
    const [timePart, ampm] = startTimeStr.trim().split(" ");
    const [startHour, startMin] = timePart.split(":").map(Number);
    const hour24 = (ampm.toUpperCase() === "PM" && startHour !== 12)
                 ? startHour + 12
                 : (ampm.toUpperCase() === "AM" && startHour === 12)
                 ? 0 : startHour;

    const startTime = new Date();
    startTime.setHours(hour24, startMin, 0, 0);

    const paceMin = parseTime(paceMinStr);
    const paceMax = parseTime(paceMaxStr);

    return distances.map(dist => {
      const minTime = new Date(startTime.getTime() + paceMin * dist);
      const maxTime = new Date(startTime.getTime() + paceMax * dist);
      return {
        distance: dist,
        minTimeClock: formatClockTime(minTime),
        maxTimeClock: formatClockTime(maxTime),
        minTimeNet: formatDuration(paceMin * dist),
        maxTimeNet: formatDuration(paceMax * dist)
      };
    });
  }

  function handleCalculate() {
    const startTime = document.getElementById("startTime").value;
    const paceMin = document.getElementById("paceMin").value;
    const paceMax = document.getElementById("paceMax").value;

    const selectedDistances = Array.from(document.querySelectorAll(".mile-list input:checked"))
      .map(cb => parseFloat(cb.value));

    const results = calculateTimeRanges(startTime, paceMin, paceMax, selectedDistances);

    let output = "";
    results.forEach(({ distance, minTimeClock, maxTimeClock, minTimeNet, maxTimeNet }) => {
      output += `Distance: ${distance} miles\nClock Time Range: ${minTimeClock} - ${maxTimeClock}\nNet Race Time Range: ${minTimeNet} - ${maxTimeNet}\n\n`;
    });

    document.getElementById("output").textContent = output;
  }
</script>
